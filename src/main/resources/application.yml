server:
  port: ${SERVER_PORT}

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # 권한이 있는 user-service 라우트 (std/tch)
        - id: user-service-with-auth
          uri: ${USER_SERVICE_URL}
          predicates:
            - Path=/std/users/**,/tch/users/**,/ara/users/**
          filters:
            - RewritePath=/(?<role>std|tch|ara)/users/(?<segment>.*), /users/${segment}

        # 권한이 없는 user-service 라우트 (학생+교사)
        - id: user-service-no-auth
          uri: ${USER_SERVICE_URL}
          predicates:
            - Path=/users/**
          filters:
            - RewritePath=/users/(?<segment>.*), /users/${segment}

        # 권한이 있는 item-service 라우트 (std/tch)
        - id: item-service-with-auth
          uri: ${ITEM_SERVICE_URL}
          predicates:
            - Path=/std/items/**,/tch/items/**,/ara/items/**
          filters:
            - RewritePath=/(?<role>std|tch|ara)/items/(?<segment>.*), /items/${segment}

        # 권한이 없는 item-service 라우트 (학생+교사)
        - id: item-service-no-auth
          uri: ${ITEM_SERVICE_URL}
          predicates:
            - Path=/items/**
          filters:
            - RewritePath=/items/(?<segment>.*), /items/${segment}

        # 권한이 있는 auth-service 라우트 (std/tch/ara)
        - id: auth-service-with-auth
          uri: ${AUTH_SERVICE_URL}
          predicates:
            - Path=/std/auth/**,/tch/auth/**,/ara/auth/**
          filters:
            - RewritePath=/(?<role>std|tch|ara)/auth/(?<segment>.*), /auth/${segment}

        # 권한이 없는 auth-service 라우트 (학생+교사)
        - id: auth-service-no-auth
          uri: ${AUTH_SERVICE_URL}
          predicates:
            - Path=/auth/**
          filters:
            - RewritePath=/auth/(?<segment>.*), /auth/${segment}

        # 권한이 있는 calendar-service 라우트 (std/tch)
        - id: calendar-service-with-auth
          uri: ${CALENDAR_SERVICE_URL}
          predicates:
            - Path=/std/calendars/**,/tch/calendars/**,/ara/calendars/**
          filters:
            - RewritePath=/(?<role>std|tch|ara)/calendars/(?<segment>.*), /calendars/${segment}

        # 권한이 없는 calendar-service 라우트 (학생+교사)
        - id: calendar-service-no-auth
          uri: ${CALENDAR_SERVICE_URL}
          predicates:
            - Path=/calendars/**
          filters:
            - RewritePath=/calendars/(?<segment>.*), /calendars/${segment}

        # 권한이 있는 team-service 라우트 (std/tch)
        - id: team-service-with-auth
          uri: ${TEAM_SERVICE_URL}
          predicates:
            - Path=/std/teamspaces/**,/tch/teamspaces/**,/ara/teamspaces/**
          filters:
            - RewritePath=/(?<role>std|tch|ara)/teamspaces/(?<segment>.*), /teamspaces/${segment}

        # 권한이 없는 team-service 라우트 (학생+교사)
        - id: team-service-no-auth
          uri: ${TEAM_SERVICE_URL}
          predicates:
            - Path=/teamspaces/**
          filters:
            - RewritePath=/teamspaces/(?<segment>.*), /teamspaces/${segment}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

logging:
  level:
    org.springframework.cloud.gateway: ${LOG_LEVEL}
    reactor.netty.http.client: ${LOG_LEVEL}
